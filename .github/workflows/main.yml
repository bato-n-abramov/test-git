# name: Deploy Website to CPanel
# on:
#   push:
#     branches:
#       - main
# jobs:
#   FTP-Deploy-Action:
#     name: FTP-Deploy-Action
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v2.1.0
#       with:
#         fetch-depth: 2
#     - name: FTP-Deploy-Action
#       uses: SamKirkland/FTP-Deploy-Action@4.3.0
#       with:
#         server: ${{ secrets.FTP_SERVER }}
#         username: ${{ secrets.FTP_USERNAME }}
#         password: ${{ secrets.FTP_PASSWORD }}
#         dry-run: true 
#         exclude: | 
#           **/wp-admin/**
#           **/wp-includes/**

on: push
name: Publish Website
jobs:
  web-deploy:
    name: ðŸš€ Deploy Website Every Commit
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2  
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: 7.4
    - name: Install Composer dependencies
      run: composer install --prefer-dist --no-progress --no-suggest
    # - name: ðŸšš Get Latest Code
    #   uses: actions/checkout@v3
    # - name: ðŸ“‚ Sync Files
    #   uses: SamKirkland/web-deploy@v1
    #   with:
    #     target-server: ${{ secrets.HOST }}
    #     ssh-port: ${{ secrets.PROT }}
    #     remote-user: ${{ secrets.USER }}
    #     private-ssh-key: ${{ secrets.KEY }}
    #     destination-path: ~/test-git.bato-webdesign.net/
    #     rsync-options: --ignore-existing --archive -u

    - name: Copying files to server
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USER }}
        port : ${{ secrets.PROT }}
        key: ${{ secrets.KEY }}
        overwrite: true
        source: ".,!vendor,!.env.example,!.git*,!./*.json,!*.lock,!*.md,!node_modules"
        target: "test-git.bato-webdesign.net"